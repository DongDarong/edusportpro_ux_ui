<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register | EduSportPro</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="/admin/admin-data-store.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            hope: {
              lime: '#8DC63F',
              cyan: '#00AEEF',
              red: '#ED1C24',
              yellow: '#FDC116',
              dark: '#1D1D1B',
              light: '#f2f4f7',
            }
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #f2f4f7;
      color: #1D1D1B;
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-xl bg-white rounded-3xl shadow-xl p-8 md:p-12 relative border border-gray-100 fade-in">
    <div class="flex flex-col items-center mb-8">
      <div class="w-14 h-14 bg-gradient-to-br from-hope-lime to-green-500 rounded-2xl flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-hope-lime/30 mb-4">
        E
      </div>
      <h1 class="text-3xl font-bold tracking-tight text-gray-900">EduSportPro</h1>
      <p class="text-gray-500 text-sm mt-1">Unified Sports Management Platform</p>
    </div>

    <div>
      <a href="/index.html" class="mb-6 text-gray-400 hover:text-gray-600 flex items-center gap-2 text-sm font-medium transition-colors group">
        <svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        Back to Sign In
      </a>

      <div class="text-center mb-8">
        <h2 class="text-2xl font-bold text-gray-900">Create Account</h2>
        <p class="text-gray-500 text-sm mt-2">Register as a coach or player.</p>
      </div>

      <form id="registerForm" class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input id="registerNameInput" type="text" required class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all" placeholder="Enter full name" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input id="registerEmailInput" type="email" required class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all" placeholder="Enter email" />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
            <select id="registerRoleInput" required class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all">
              <option value="">Select role</option>
              <option value="Coach">Coach</option>
              <option value="Player">Player</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone (Optional)</label>
            <input id="registerPhoneInput" type="text" class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all" placeholder="012 345 678" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input id="registerPasswordInput" type="password" required minlength="8" class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all" placeholder="Min. 8 characters" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
          <input id="registerConfirmPasswordInput" type="password" required minlength="8" class="w-full rounded-xl border border-gray-200 bg-gray-50 p-3 text-gray-900 focus:bg-white focus:border-hope-cyan focus:ring-2 focus:ring-hope-cyan/20 outline-none transition-all" placeholder="Confirm password" />
        </div>

        <label class="flex items-start gap-2 text-sm text-gray-600">
          <input id="registerTermsInput" type="checkbox" class="mt-0.5 h-4 w-4 text-hope-cyan focus:ring-hope-cyan border-gray-300 rounded cursor-pointer">
          I agree to the terms and privacy policy.
        </label>

        <p id="registerMsg" class="hidden text-sm font-medium"></p>

        <button type="submit" class="w-full py-3 px-4 border border-transparent rounded-xl shadow-lg shadow-hope-cyan/30 text-sm font-bold text-white bg-hope-cyan hover:bg-sky-500 focus:outline-none transition-all transform active:scale-[0.98]">
          Create Account
        </button>
      </form>
    </div>
  </div>

  <script>
    function normalize(value) {
      return String(value || '').trim().toLowerCase();
    }

    function showRegisterMessage(message, isError) {
      const msg = document.getElementById('registerMsg');
      if (!msg) return;
      msg.textContent = message;
      msg.classList.remove('hidden', 'text-red-600', 'text-emerald-600');
      msg.classList.add(isError ? 'text-red-600' : 'text-emerald-600');
    }

    function generateUserId(users) {
      let max = 0;
      users.forEach(function (user) {
        const match = String(user.id || '').match(/^U(\d+)$/i);
        if (!match) return;
        const n = Number(match[1]);
        if (Number.isFinite(n) && n > max) max = n;
      });
      return 'U' + String(max + 1).padStart(3, '0');
    }

    function defaultPermissionsByRole(role) {
      if (role === 'Coach') return ['Matches', 'Teams'];
      if (role === 'Player') return ['View Only'];
      return [];
    }

    async function handleRegisterSubmit(event) {
      event.preventDefault();
      showRegisterMessage('', true);

      const name = String(document.getElementById('registerNameInput').value || '').trim();
      const email = normalize(document.getElementById('registerEmailInput').value);
      const role = String(document.getElementById('registerRoleInput').value || '').trim();
      const phone = String(document.getElementById('registerPhoneInput').value || '').trim();
      const password = String(document.getElementById('registerPasswordInput').value || '');
      const confirmPassword = String(document.getElementById('registerConfirmPasswordInput').value || '');
      const termsChecked = document.getElementById('registerTermsInput').checked;

      if (!name || !email || !role || !password) {
        showRegisterMessage('Please complete all required fields.', true);
        return;
      }
      if (!termsChecked) {
        showRegisterMessage('Please accept the terms to continue.', true);
        return;
      }
      if (password.length < 8) {
        showRegisterMessage('Password must be at least 8 characters.', true);
        return;
      }
      if (password !== confirmPassword) {
        showRegisterMessage('Passwords do not match.', true);
        return;
      }
      if (!window.AdminDataStore) {
        showRegisterMessage('Data source unavailable. Refresh and try again.', true);
        return;
      }

      const users = window.AdminDataStore.getArray('users', []);
      const exists = users.some(function (user) {
        return normalize(user.email) === email;
      });
      if (exists) {
        showRegisterMessage('This email is already registered.', true);
        return;
      }

      const newUser = {
        id: generateUserId(users),
        name: name,
        email: email,
        role: role,
        status: 'Pending',
        phone: phone,
        permissions: defaultPermissionsByRole(role),
        password: password,
        createdAt: new Date().toISOString()
      };

      users.push(newUser);
      window.AdminDataStore.set('users', users);

      showRegisterMessage('Account created successfully. Redirecting to sign in...', false);
      setTimeout(function () {
        window.location.href = '/index.html';
      }, 900);
    }

    document.addEventListener('DOMContentLoaded', async function () {
      if (window.AdminDataStore) {
        await window.AdminDataStore.bootstrap();
      }
      const form = document.getElementById('registerForm');
      if (form) form.addEventListener('submit', handleRegisterSubmit);
    });
  </script>
</body>

</html>
